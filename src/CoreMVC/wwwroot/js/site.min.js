function loadItems(){xhrGet(REST_DATA+"/GetAll",function(e){document.getElementById("loading").innerHTML="";var t,n=e||[],o=[];for(t=0;t<n.length;++t){var a=n[t];a&&"_id"in a&&"text"in a&&o.push(a)}for(t=0;t<o.length;++t)addItem(o[t],!1)},function(e){console.error(e),document.getElementById("loading").innerHTML="ERROR"})}function addItem(e,t){{var n=document.createElement("tr"),o=e&&e._id;e&&e._rev}o&&n.setAttribute("data-id",o),n.innerHTML="<td style='width:90%'><textarea onchange='saveChange(this)' onkeydown='onKey(event)'></textarea></td><td class='deleteBtn' onclick='deleteItem(this)' title='delete me'></td>";var a=document.getElementById("notes");console.log(a.lastChild),a.lastChild.appendChild(n);var r=n.firstChild.firstChild;e&&(r.value=e.text),n.isNew=!e||t,r.focus()}function deleteItem(e){var t=e.parentNode;t.parentNode.removeChild(t),xhrDelete(REST_DATA+"/Delete?id="+t.getAttribute("data-id")+"&text="+t.getAttribute("data-text"),function(){},function(e){console.error(e)})}function onKey(e){if(e.keyCode==KEY_ENTER&&!e.shiftKey){e.stopPropagation(),e.preventDefault();var t=e.target.parentNode.parentNode;t.nextSibling?t.nextSibling.firstChild.firstChild.focus():addItem()}}function saveChange(e,t){var n=e.parentNode.parentNode,o=n.getAttribute("data-id"),a=e.value;o=null==o?"":o;var r={id:o,text:a};n.isNew?(delete n.isNew,xhrPost(REST_DATA+"/Create",r,function(e){n.setAttribute("data-id",e.id),n.setAttribute("data-text",e.text),t&&t()},function(e){console.error(e)})):xhrPut(REST_DATA+"/Update",r,function(){console.log("updated: ",r)},function(e){console.error(e)})}function toggleServiceInfo(){var e=document.getElementById("dbserviceinfo");e.style.display="none"==e.style.display?"":"none"}function createXHR(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}function xhrGet(e,t,n){var o=new createXHR;o.open("GET",e,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?t(parseJson(o.responseText)):n("service not available"))},o.ontimeout=n,o.send()}function xhrPut(e,t,n,o){var a=new createXHR;a.open("PUT",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?n():o("service not available"))},a.timeout=3e3,a.ontimeout=o,a.send(objectToQuery(t))}function xhrPost(e,t,n,o){var a=new createXHR;a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?n(parseJson(a.responseText)):o("service not available"))},a.timeout=3e3,a.ontimeout=o,a.send(objectToQuery(t))}function xhrDelete(e,t,n){var o=new createXHR;o.open("DELETE",e,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?t():n("service not available"))},o.timeout=3e3,o.ontimeout=n,o.send()}function parseJson(str){return window.JSON?JSON.parse(str):eval("("+str+")")}function objectToQuery(e){var t=encodeURIComponent,n=[];for(var o in e){var a=e[o],r=t(o)+"=";if(a&&(a instanceof Array||"array"==typeof a))for(var i=0,d=a.length;d>i;++i)n.push(r+t(a[i]));else n.push(r+t(a))}return n.join("&")}var REST_DATA="api/db",KEY_ENTER=13;loadItems();